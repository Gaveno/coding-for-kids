/* ===== Timeline Container ===== */
.timeline-container {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--spacing-sm);
    box-shadow: var(--shadow);
}

/* Tween Mode: Neon border effect */
[data-mode="tween"] .timeline-container {
    box-shadow: 0 0 15px rgba(0, 245, 212, 0.3),
                var(--shadow);
}

/* ===== Timeline Header ===== */
.timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-xs) var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
}

.timeline-controls-left {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.length-btn {
    width: 36px;
    height: 36px;
    border: none;
    border-radius: var(--radius-sm);
    background: var(--color-surface-light);
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform var(--transition-fast), background var(--transition-fast);
}

.length-btn:hover {
    transform: scale(1.1);
    background: var(--color-primary);
}

.length-btn:active {
    transform: scale(0.95);
}

.beat-count {
    font-size: 1.2rem;
    color: var(--color-text);
    min-width: 32px;
    text-align: center;
    font-weight: bold;
}

/* Kid Mode: Larger controls */
[data-mode="kid"] .length-btn {
    width: 48px;
    height: 48px;
    font-size: 1.5rem;
}

[data-mode="kid"] .beat-count {
    font-size: 1.8rem;
    min-width: 48px;
}

/* Key Selector */
.key-selector {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.key-selector label {
    font-size: 0.9rem;
    color: var(--color-text);
    font-weight: bold;
}

#key-select {
    font-size: 16px; /* Prevents zoom on mobile */
    padding: 8px 12px;
    min-width: 120px;
    min-height: 44px; /* Touch-friendly */
    border: 2px solid var(--color-surface-light);
    border-radius: var(--radius-sm);
    background: var(--color-surface);
    color: var(--color-text);
    cursor: pointer;
    transition: border-color var(--transition-fast);
}

#key-select:hover {
    border-color: var(--color-primary);
}

#key-select:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(85, 80, 229, 0.1);
}

.clear-btn {
    font-size: 1.4rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: var(--radius-sm);
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform var(--transition-fast), background var(--transition-fast);
}

.clear-btn:hover {
    transform: scale(1.1);
    background: rgba(255, 107, 107, 0.2);
}

/* ===== Timeline Scroll ===== */
.timeline-scroll {
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    border-radius: var(--radius-md);
    background: var(--color-surface-light);
}

/* ===== Timeline ===== */
.timeline {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: fit-content;
    padding-left: var(--track-label-width);
}

/* ===== Playhead ===== */
.playhead {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--color-warning);
    border-radius: 2px;
    z-index: 10;
    opacity: 0;
    left: var(--track-label-width);
    box-shadow: 0 0 8px var(--color-warning);
    transition: opacity var(--transition-fast);
    pointer-events: none;
}

.playhead.active {
    opacity: 1;
}

/* ===== Beat Markers ===== */
.beat-markers {
    display: flex;
    height: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.beat-marker {
    width: var(--cell-size);
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.4);
    border-right: 1px solid rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease;
}

.beat-marker:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.8);
}

[data-mode="tween"] .beat-marker:hover {
    background-color: rgba(0, 245, 212, 0.2);
    color: var(--color-accent);
}

.beat-marker.downbeat {
    color: rgba(255, 255, 255, 0.7);
    font-weight: bold;
    border-right-color: rgba(255, 255, 255, 0.2);
}

.beat-marker.downbeat:hover {
    color: white;
}

/* ===== Pattern Blocks Row ===== */
.pattern-blocks-row {
    position: relative;
    height: 32px;
    min-height: 32px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
}

/* ===== Track ===== */
.track {
    display: flex;
    align-items: stretch;
    min-height: var(--cell-size);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.track:last-child {
    border-bottom: none;
}

.track-label {
    position: absolute;
    left: 0;
    width: var(--track-label-width);
    height: var(--cell-size);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    background: var(--color-surface);
    border: none;
    border-right: 1px solid rgba(255, 255, 255, 0.1);
    cursor: pointer;
    transition: all var(--transition-fast);
    padding: 0;
}

.track-label.clickable {
    min-width: 44px; /* Touch-friendly */
    min-height: 44px;
}

.track-label.clickable:hover {
    background: var(--color-surface-light);
    transform: scale(1.05);
}

.track-label.clickable:active {
    transform: scale(0.95);
}

[data-mode="studio"] .track-label.clickable::after {
    content: '⚙️';
    position: absolute;
    bottom: 2px;
    right: 2px;
    font-size: 10px;
    opacity: 0.5;
}

.track-label-container {
    position: absolute;
    left: 0;
    width: var(--track-label-width);
    height: var(--cell-size);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    background: var(--color-surface);
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}

.track-label-container .track-label {
    position: static;
    width: auto;
    height: auto;
    border: none;
    background: none;
    font-size: 1.2rem;
}

.waveform-select {
    font-size: 14px;
    padding: 2px 6px;
    min-height: 24px;
    border: 1px solid var(--color-surface-light);
    border-radius: var(--radius-sm);
    background: var(--color-surface-light);
    color: var(--color-text);
    cursor: pointer;
    transition: border-color var(--transition-fast);
    font-family: monospace;
    width: 44px;
}

.waveform-select:hover {
    border-color: var(--color-primary);
}

.waveform-select:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
}

/* Effect Controls */
.effects-controls {
    display: flex;
    gap: 2px;
    align-items: center;
}

.effect-btn {
    width: 24px;
    height: 24px;
    border: 1px solid var(--color-surface-light);
    border-radius: var(--radius-sm);
    background: var(--color-surface-light);
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
    opacity: 0.5;
}

.effect-btn:hover {
    transform: scale(1.1);
    opacity: 0.8;
}

.effect-btn.active {
    opacity: 1;
    border-color: var(--color-primary);
    background: var(--color-primary);
    box-shadow: 0 0 8px var(--color-primary);
}

.effect-btn:active {
    transform: scale(0.95);
}

.track-cells {
    display: flex;
    flex: 1;
}

/* Track backgrounds */
.track[data-track="1"] {
    background: var(--track-melody);
}

.track[data-track="2"] {
    background: var(--track-bass);
}

.track[data-track="3"] {
    background: var(--track-percussion);
}

/* Track drag availability states */
.track.drop-unavailable {
    opacity: 0.3;
    filter: grayscale(0.5);
}

.track.drop-available {
    box-shadow: inset 0 0 0 2px var(--color-success);
}

/* ===== Track Cell ===== */
.track-cell {
    width: var(--cell-size);
    height: var(--cell-size);
    border-right: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background var(--transition-fast);
    position: relative;
}

.track-cell:hover {
    background: rgba(255, 255, 255, 0.1);
}

.track-cell.downbeat {
    border-right-color: rgba(255, 255, 255, 0.15);
}

/* Cell with note */
.track-cell.has-note {
    background: transparent;
    overflow: visible;
}

/* Cell covered by extended note */
.track-cell.covered-by-note {
    background: transparent;
    pointer-events: none;
}

.track-cell .cell-note {
    font-size: 1.3rem;
    font-weight: bold;
    color: white;
    animation: notePopIn 0.2s ease-out;
    cursor: grab;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding-left: 8px;
    height: calc(var(--cell-size) - 6px);
    width: calc(var(--cell-size) - 4px);
    background: rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-sm);
    position: absolute;
    left: 2px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 5;
    user-select: none;
    touch-action: none;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

/* Tween Mode: Glow effect on notes */
[data-mode="tween"] .track-cell .cell-note {
    box-shadow: 0 0 8px rgba(0, 245, 212, 0.4),
                0 2px 6px rgba(0, 0, 0, 0.2);
}

/* Note-specific background colors matching piano key text colors */
.track-cell .cell-note[data-note="C"] { background: #e74c3c; } /* Red */
.track-cell .cell-note[data-note="C#"] { background: #ff6b6b; } /* Light Red */
.track-cell .cell-note[data-note="D"] { background: #f39c12; } /* Orange */
.track-cell .cell-note[data-note="D#"] { background: #ffd93d; color: #333; } /* Yellow - dark text */
.track-cell .cell-note[data-note="E"] { background: #3498db; } /* Blue */
.track-cell .cell-note[data-note="F"] { background: #9b59b6; } /* Purple */
.track-cell .cell-note[data-note="F#"] { background: #a29bfe; } /* Light Purple */
.track-cell .cell-note[data-note="G"] { background: #2ecc71; } /* Green */
.track-cell .cell-note[data-note="G#"] { background: #6bcf7f; } /* Light Green */
.track-cell .cell-note[data-note="A"] { background: #e67e22; } /* Dark Orange */
.track-cell .cell-note[data-note="A#"] { background: #fab1a0; } /* Peach */
.track-cell .cell-note[data-note="B"] { background: #1abc9c; } /* Teal */

/* Extended note styling */
.track-cell .cell-note.extended {
    border-radius: var(--radius-md);
    background: linear-gradient(90deg, 
        rgba(255, 255, 255, 0.35) 0%, 
        rgba(255, 255, 255, 0.25) 50%,
        rgba(255, 255, 255, 0.35) 100%);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

/* Octave Indicator (Studio Mode only) */
.octave-indicator {
    position: absolute;
    top: 2px;
    right: 4px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    font-size: 10px;
    font-weight: bold;
    padding: 2px 4px;
    border-radius: 3px;
    pointer-events: none;
    z-index: 2;
}

[data-mode="studio"] .octave-indicator {
    background: rgba(74, 158, 255, 0.9);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Hide octave indicator in Kid/Tween modes */
[data-mode="kid"] .octave-indicator,
[data-mode="tween"] .octave-indicator {
    display: none;
}

/* Velocity Indicator */
.velocity-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 6px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 3px 0 0 3px;
    transition: all 0.1s ease-out;
    pointer-events: none;
}

/* Active state: expand and move left during adjustment */
.velocity-indicator.active {
    width: 20px;
    left: -24px;
    background: rgba(255, 255, 255, 0.95);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    border: 2px solid rgba(255, 255, 255, 0.8);
}

/* Hide velocity indicator in Kid Mode */
[data-mode="kid"] .velocity-indicator {
    display: none;
}

/* Enhanced velocity indicator in Tween Mode */
[data-mode="tween"] .velocity-indicator {
    background: rgba(0, 245, 212, 0.7);
    box-shadow: 0 0 4px rgba(0, 245, 212, 0.6);
}

[data-mode="tween"] .velocity-indicator.active {
    background: var(--color-accent);
    box-shadow: 0 0 12px var(--color-accent),
                0 2px 8px rgba(0, 0, 0, 0.3);
    border-color: var(--color-accent);
}

/* Adjusting velocity state */
.cell-note.adjusting-velocity {
    border: 2px solid rgba(255, 255, 255, 0.9);
    cursor: ns-resize;
    z-index: 100;
}

[data-mode="tween"] .cell-note.adjusting-velocity {
    border-color: var(--color-accent);
    box-shadow: 0 0 20px var(--color-accent);
}


/* Note-specific background colors matching piano key text colors */
.track-cell .cell-note[data-note="C"] { background: #e74c3c; } /* Red */
.track-cell .cell-note[data-note="C#"] { background: #ff6b6b; } /* Light Red */
.track-cell .cell-note[data-note="D"] { background: #f39c12; } /* Orange */
.track-cell .cell-note[data-note="D#"] { background: #ffd93d; color: #333; } /* Yellow - dark text */
.track-cell .cell-note[data-note="E"] { background: #3498db; } /* Blue */
.track-cell .cell-note[data-note="F"] { background: #9b59b6; } /* Purple */
.track-cell .cell-note[data-note="F#"] { background: #a29bfe; } /* Light Purple */
.track-cell .cell-note[data-note="G"] { background: #2ecc71; } /* Green */
.track-cell .cell-note[data-note="G#"] { background: #6bcf7f; } /* Light Green */
.track-cell .cell-note[data-note="A"] { background: #e67e22; } /* Dark Orange */
.track-cell .cell-note[data-note="A#"] { background: #fab1a0; } /* Peach */
.track-cell .cell-note[data-note="B"] { background: #1abc9c; } /* Teal */

/* Extended note colors - use gradients for visual interest */
.track-cell .cell-note.extended[data-note="C"] { background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%); }
.track-cell .cell-note.extended[data-note="C#"] { background: linear-gradient(90deg, #ff6b6b 0%, #ee5a5a 100%); }
.track-cell .cell-note.extended[data-note="D"] { background: linear-gradient(90deg, #f39c12 0%, #d68910 100%); }
.track-cell .cell-note.extended[data-note="D#"] { background: linear-gradient(90deg, #ffd93d 0%, #f4ca30 100%); }
.track-cell .cell-note.extended[data-note="E"] { background: linear-gradient(90deg, #3498db 0%, #2980b9 100%); }
.track-cell .cell-note.extended[data-note="F"] { background: linear-gradient(90deg, #9b59b6 0%, #8e44ad 100%); }
.track-cell .cell-note.extended[data-note="F#"] { background: linear-gradient(90deg, #a29bfe 0%, #7b6ef6 100%); }
.track-cell .cell-note.extended[data-note="G"] { background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%); }
.track-cell .cell-note.extended[data-note="G#"] { background: linear-gradient(90deg, #6bcf7f 0%, #55b46b 100%); }
.track-cell .cell-note.extended[data-note="A"] { background: linear-gradient(90deg, #e67e22 0%, #ca6c1d 100%); }
.track-cell .cell-note.extended[data-note="A#"] { background: linear-gradient(90deg, #fab1a0 0%, #f29d87 100%); }
.track-cell .cell-note.extended[data-note="B"] { background: linear-gradient(90deg, #1abc9c 0%, #16a085 100%); }

/* Resizing state */
.track-cell .cell-note.resizing {
    cursor: ew-resize;
    opacity: 0.85;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
}

/* Hint for drag-to-resize */
.track-cell .cell-note::after {
    content: '';
    position: absolute;
    right: 4px;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 50%;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 2px;
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.track-cell .cell-note:hover::after,
.track-cell .cell-note.extended::after {
    opacity: 1;
}

/* Drop target state */
.track-cell.drop-target {
    background: rgba(255, 255, 255, 0.3);
    box-shadow: inset 0 0 0 2px var(--color-success);
}

/* Playing state */
.track-cell.playing {
    background: rgba(255, 230, 109, 0.4);
    box-shadow: inset 0 0 10px var(--color-warning);
}

@keyframes notePopIn {
    0% { transform: scale(0); opacity: 0; }
    70% { transform: scale(1.2); }
    100% { transform: scale(1); opacity: 1; }
}

/* ===== Responsive Styles ===== */
@media (max-width: 768px) {
    .timeline-header {
        flex-wrap: wrap;
        gap: var(--spacing-xs);
    }
    
    .key-selector {
        order: -1;
        width: 100%;
        justify-content: center;
    }
    
    #key-select {
        flex: 1;
        max-width: 300px;
    }
    
    .key-selector label {
        font-size: 0.85rem;
    }
}

@media (max-width: 480px) {
    .timeline-header {
        padding: var(--spacing-xs);
    }
    
    .key-selector label {
        display: none; /* Hide label on very small screens */
    }
    
    #key-select {
        min-width: 100px;
    }
}
